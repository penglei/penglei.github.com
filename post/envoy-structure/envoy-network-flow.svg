<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="610px" preserveAspectRatio="none" style="width:1431px;height:610px;" version="1.1" viewBox="0 0 1431 610" width="1431px" zoomAndPan="magnify"><defs><filter height="300%" id="f11rnjz7oofo2j" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f11rnjz7oofo2j)" height="335.1055" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="393" y="123.4199"/><rect fill="#FFFFFF" filter="url(#f11rnjz7oofo2j)" height="249.4844" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="626" y="152.7305"/><rect fill="#FFFFFF" filter="url(#f11rnjz7oofo2j)" height="102.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="796.5" y="182.041"/><rect fill="#FFFFFF" filter="url(#f11rnjz7oofo2j)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1049.5" y="314.2832"/><rect fill="#FFFFFF" filter="url(#f11rnjz7oofo2j)" height="411.0371" style="stroke: #000000; stroke-width: 2.0;" width="1307" x="13" y="55.4883"/><rect fill="#FFFFFF" filter="url(#f11rnjz7oofo2j)" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="354.5" x="700" y="197.041"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="104" x2="104" y1="38.4883" y2="598.457"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="248.5" x2="248.5" y1="38.4883" y2="598.457"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="397.5" x2="397.5" y1="38.4883" y2="598.457"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="631" x2="631" y1="38.4883" y2="598.457"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="801" x2="801" y1="38.4883" y2="598.457"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1054" x2="1054" y1="38.4883" y2="598.457"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1217" x2="1217" y1="38.4883" y2="598.457"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1367" x2="1367" y1="38.4883" y2="598.457"/><rect fill="#FEFECE" filter="url(#f11rnjz7oofo2j)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="158" x="23" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="144" x="30" y="23.5352">ListenerManagerImpl</text><rect fill="#FEFECE" filter="url(#f11rnjz7oofo2j)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="200.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="207.5" y="23.5352">WorkerImpl</text><rect fill="#FEFECE" filter="url(#f11rnjz7oofo2j)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="177" x="307.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="163" x="314.5" y="23.5352">ConnectionHandlerImpl</text><rect fill="#FEFECE" filter="url(#f11rnjz7oofo2j)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="134" x="562" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="569" y="23.5352">ActiveTcpListener</text><rect fill="#FEFECE" filter="url(#f11rnjz7oofo2j)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="179" x="710" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="165" x="717" y="23.5352">ListenSocketFactoryImpl</text><rect fill="#FEFECE" filter="url(#f11rnjz7oofo2j)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="117" x="994" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="103" x="1001" y="23.5352">DispatcherImpl</text><rect fill="#FEFECE" filter="url(#f11rnjz7oofo2j)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="181" x="1125" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="167" x="1132" y="23.5352">ConnectionBalancerImpl</text><rect fill="#99FF99" filter="url(#f11rnjz7oofo2j)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="90" x="1320" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="76" x="1327" y="23.5352">ListnerImpl</text><rect fill="#FFFFFF" filter="url(#f11rnjz7oofo2j)" height="335.1055" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="393" y="123.4199"/><rect fill="#FFFFFF" filter="url(#f11rnjz7oofo2j)" height="249.4844" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="626" y="152.7305"/><rect fill="#FFFFFF" filter="url(#f11rnjz7oofo2j)" height="102.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="796.5" y="182.041"/><rect fill="#FFFFFF" filter="url(#f11rnjz7oofo2j)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1049.5" y="314.2832"/><path d="M13,55.4883 L87,55.4883 L87,62.4883 L77,72.4883 L13,72.4883 L13,55.4883 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="411.0371" style="stroke: #000000; stroke-width: 2.0;" width="1307" x="13" y="55.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="28" y="69.0566">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="65" x="102" y="68.123">[N workers]</text><polygon fill="#A80036" points="237,90.1094,247,94.1094,237,98.1094,241,94.1094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="104" x2="243" y1="94.1094" y2="94.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="111" y="89.3672">addListener(config)</text><polygon fill="#A80036" points="381,119.4199,391,123.4199,381,127.4199,385,123.4199" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="249" x2="387" y1="123.4199" y2="123.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="256" y="118.6777">addListener(config)</text><polygon fill="#A80036" points="614,148.7305,624,152.7305,614,156.7305,618,152.7305" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="403" x2="620" y1="152.7305" y2="152.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="25" x="410" y="147.9883">new</text><polygon fill="#A80036" points="784.5,178.041,794.5,182.041,784.5,186.041,788.5,182.041" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="636" x2="790.5" y1="182.041" y2="182.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="643" y="177.2988">getListenSocket</text><path d="M700,197.041 L762,197.041 L762,204.041 L752,214.041 L700,214.041 L700,197.041 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="354.5" x="700" y="197.041"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="715" y="210.6094">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="130" x="777" y="209.6758">[ssocket is not created]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="806.5" x2="848.5" y1="235.6621" y2="235.6621"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="848.5" x2="848.5" y1="235.6621" y2="248.6621"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="807.5" x2="848.5" y1="248.6621" y2="248.6621"/><polygon fill="#A80036" points="817.5,244.6621,807.5,248.6621,817.5,252.6621,813.5,248.6621" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="813.5" y="230.9199">createListenSocketAndApplyOptions</text><polygon fill="#A80036" points="647,280.9727,637,284.9727,647,288.9727,643,284.9727" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="641" x2="800.5" y1="284.9727" y2="284.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="653" y="280.2305">Socket</text><polygon fill="#A80036" points="1037.5,310.2832,1047.5,314.2832,1037.5,318.2832,1041.5,314.2832" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="636" x2="1043.5" y1="314.2832" y2="314.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="279" x="643" y="309.541">createListener(socket, this, bool bindToPort)</text><polygon fill="#A80036" points="647,339.5938,637,343.5938,647,347.5938,643,343.5938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="641" x2="1053.5" y1="343.5938" y2="343.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="653" y="338.8516">ListenerImpl</text><polygon fill="#A80036" points="1205.5,368.9043,1215.5,372.9043,1205.5,376.9043,1209.5,372.9043" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="636" x2="1211.5" y1="372.9043" y2="372.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="643" y="368.1621">registerHandler(this)</text><polygon fill="#A80036" points="414,398.2148,404,402.2148,414,406.2148,410,402.2148" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="408" x2="630" y1="402.2148" y2="402.2148"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="420" y="397.4727">ActiveTcpListener</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="403" x2="445" y1="431.5254" y2="431.5254"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="445" x2="445" y1="431.5254" y2="444.5254"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="404" x2="445" y1="444.5254" y2="444.5254"/><polygon fill="#A80036" points="414,440.5254,404,444.5254,414,448.5254,410,444.5254" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="410" y="426.7832">listeners_.emplace_back(listener)</text><polygon fill="#A80036" points="260,454.5254,250,458.5254,260,462.5254,256,458.5254" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="254" x2="397" y1="458.5254" y2="458.5254"/><rect fill="#EEEEEE" filter="url(#f11rnjz7oofo2j)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1416" x="3" y="494.1807"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1419" y1="494.1807" y2="494.1807"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1419" y1="497.1807" y2="497.1807"/><rect fill="#EEEEEE" filter="url(#f11rnjz7oofo2j)" height="23.3105" style="stroke: #000000; stroke-width: 2.0;" width="148" x="637" y="483.5254"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="130" x="643" y="500.0938">Dealing connection</text><polygon fill="#A80036" points="642,534.1465,632,538.1465,642,542.1465,638,538.1465" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="636" x2="1366" y1="538.1465" y2="538.1465"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="59" x="648" y="533.4043">onAccept</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="631" x2="673" y1="572.457" y2="572.457"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="673" x2="673" y1="572.457" y2="585.457"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="626" x2="673" y1="585.457" y2="585.457"/><polygon fill="#0000FF" points="636,581.457,626,585.457,636,589.457,632,585.457" style="stroke: #0000FF; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="638" y="567.7148">onAcceptWorker</text><!--MD5=[e638c6a10438fe2b4a678a10760f0032]
@startuml
hide footbox

loop N workers
  ListenerManagerImpl -> WorkerImpl: addListener(config)
    WorkerImpl -> ConnectionHandlerImpl: addListener(config)

      activate ConnectionHandlerImpl
        ConnectionHandlerImpl -> ActiveTcpListener: new

        activate ActiveTcpListener
        ActiveTcpListener -> ListenSocketFactoryImpl: getListenSocket

          activate ListenSocketFactoryImpl
          alt ssocket is not created
            ListenSocketFactoryImpl -> ListenSocketFactoryImpl: createListenSocketAndApplyOptions
          end
          return Socket

        ActiveTcpListener -> DispatcherImpl: createListener(socket, this, bool bindToPort)
        activate DispatcherImpl
        DispatcherImpl -> ActiveTcpListener: ListenerImpl
        deactivate DispatcherImpl

        ActiveTcpListener -> ConnectionBalancerImpl: registerHandler(this)

        return ActiveTcpListener

      ConnectionHandlerImpl -> ConnectionHandlerImpl: listeners_.emplace_back(listener)
      return
end

== Dealing connection ==

participant ListnerImpl #99FF99
activate ActiveTcpListener
ListnerImpl - -> ActiveTcpListener: onAccept
ActiveTcpListener -[#0000FF]> ActiveTcpListener: onAcceptWorker
deactivate ActiveTcpListener

@enduml

PlantUML version 1.2020.05(Fri Mar 20 05:17:32 CST 2020)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 13+33
Operating System: Mac OS X
Default Encoding: UTF-8
Language: zh
Country: CN
--></g></svg>