---
slug: setting-up-kubernetes-manually
title: 纯手功安装kubernetes
date: 2019-01-20
draft: true
categories: [container]
---

= 纯手工安装kubernetes
penglei <penglei@ybyte.org>
:toc:
:icons: font
:k8s-self-hosted: https://coreos.com/blog/self-hosted-kubernetes.html

The '90s popularized a new form of music known as "`grunge`" rock.
Its influence extended well beyond music.


== k8s 简介

=== 总体架构
=== 认证与授权

[#aggregation-layer]
=== Aggregation Layer
 
`Aggregation Layer` 在文档中也会以词语 `front proxy` 出现。

=== self-hosted

{k8s-self-hosted}[`self-hosted`^] 可以让k8s以更 *优雅* 的方式运行。


== 部署准备

=== 准备证书(CA & client/server certs)
=== 准备凭证(Credentials)

== 基础环境部署

=== 初始化host
=== 部署 `master` 节点
=== 部署 `node` 节点
=== 启动集群

== 集群组件安装

=== DNS 服务安装
=== 网络插件安装

.calico 安装

.cilium 安装

== 补充

=== 虚拟机环境

=== istio 安装



[source,go]
----
package main

import (
	"runtime"
	"os"
	"github.com/gohugoio/hugo/commands"
)

func main() {
	runtime.GOMAXPROCS(runtime.NumCPU())
	resp := commands.Execute(os.Args[1:])

	if resp.Err != nil {
		if resp.IsUserError() {
			resp.Cmd.Println("")
			resp.Cmd.Println(resp.Cmd.UsageString())
		}
		os.Exit(-1)
	}
}
----


[source,bash]
----
helm template install/kubernetes/helm/istio --name istio --namespace istio-system \
    --set servicegraph.enabled=true \
    --set kiali.enabled=true \
    --set tracing.enabled=true \
    --set pilot.traceSampling=100.0 \
    --set grafana.enabled=true \
    --set "kiali.dashboard.jaegerURL=http://nas:16686" \
    --set "kiali.dashboard.grafanaURL=http://nas:3000" \
    --set gateways.istio-ingressgateway.type=NodePort \
    --set gateways.istio-egressgateway.type=NodePort \
    --set security.enabled=true > istio-nodeport.yaml

kubectl apply -f istio-nodeport.yaml
----

hahaha

{{< gist spf13 7896402 >}}

{{<highlight go "linenostart=1,hl_lines=,linenos=table">}}
package main

import (
	"runtime"
	"os"
	"github.com/gohugoio/hugo/commands"
)

func main() {
	runtime.GOMAXPROCS(runtime.NumCPU())
	resp := commands.Execute(os.Args[1:])

	if resp.Err != nil {
		if resp.IsUserError() {
			resp.Cmd.Println("")
			resp.Cmd.Println(resp.Cmd.UsageString())
		}
		os.Exit(-1)
	}
}
{{</ highlight>}}